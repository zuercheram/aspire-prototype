{
  "$schema": "https://json.schemastore.org/aspire-8.0.json",
  "resources":
    {
      "apsire-prototype-app-insights":
        {
          "type": "azure.bicep.v0",
          "connectionString": "{apsire-prototype-app-insights.outputs.appInsightsConnectionString}",
          "path": "apsire-prototype-app-insights.module.bicep",
          "params": { "logAnalyticsWorkspaceId": "" },
        },
      "apsire-prototype-sql-server":
        {
          "type": "container.v0",
          "connectionString": "Server={apsire-prototype-sql-server.bindings.tcp.host},{apsire-prototype-sql-server.bindings.tcp.port};User ID=sa;Password={apsire-prototype-sql-server-password.value};TrustServerCertificate=true",
          "image": "mcr.microsoft.com/mssql/server:2022-latest",
          "env":
            {
              "ACCEPT_EULA": "Y",
              "MSSQL_SA_PASSWORD": "{apsire-prototype-sql-server-password.value}",
              "APPLICATIONINSIGHTS_CONNECTION_STRING": "{apsire-prototype-app-insights.connectionString}",
            },
          "bindings":
            {
              "tcp":
                {
                  "scheme": "tcp",
                  "protocol": "tcp",
                  "transport": "tcp",
                  "targetPort": 1433,
                },
            },
        },
      "apsire-prototype-sql-database":
        {
          "type": "value.v0",
          "connectionString": "{apsire-prototype-sql-server.connectionString};Database=apsire-prototype-sql-database",
        },
      "apsire-prototype-secrets":
        {
          "type": "azure.bicep.v0",
          "connectionString": "{apsire-prototype-secrets.outputs.vaultUri}",
          "path": "apsire-prototype-secrets.module.bicep",
          "params": { "principalId": "", "principalType": "" },
        },
      "apsire-prototype-migrations":
        {
          "type": "project.v0",
          "path": "../Domain.Migrations/Aspire.Prototype.Domain.Migrations.csproj",
          "env":
            {
              "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES": "true",
              "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES": "true",
              "OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY": "in_memory",
              "ConnectionStrings__apsire-prototype-sql-database": "{apsire-prototype-sql-database.connectionString}",
              "APPLICATIONINSIGHTS_CONNECTION_STRING": "{apsire-prototype-app-insights.connectionString}",
            },
        },
      "apsire-prototype-server":
        {
          "type": "project.v0",
          "path": "../Server/Aspire.Prototype.Server.csproj",
          "env":
            {
              "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES": "true",
              "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES": "true",
              "OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY": "in_memory",
              "ASPNETCORE_FORWARDEDHEADERS_ENABLED": "true",
              "HTTP_PORTS": "{apsire-prototype-server.bindings.http.targetPort}",
              "ConnectionStrings__apsire-prototype-secrets": "{apsire-prototype-secrets.connectionString}",
              "ConnectionStrings__apsire-prototype-sql-database": "{apsire-prototype-sql-database.connectionString}",
              "APPLICATIONINSIGHTS_CONNECTION_STRING": "{apsire-prototype-app-insights.connectionString}",
            },
          "bindings":
            {
              "http":
                {
                  "scheme": "http",
                  "protocol": "tcp",
                  "transport": "http",
                  "external": true,
                },
              "https":
                {
                  "scheme": "https",
                  "protocol": "tcp",
                  "transport": "http",
                  "external": true,
                },
            },
        },
      "apsire-prototype-react":
        {
          "type": "dockerfile.v0",
          "path": "../Client/Dockerfile",
          "context": "../Client",
          "env":
            {
              "NODE_ENV": "development",
              "services__apsire-prototype-server__http__0": "{apsire-prototype-server.bindings.http.url}",
              "services__apsire-prototype-server__https__0": "{apsire-prototype-server.bindings.https.url}",
              "APPLICATIONINSIGHTS_CONNECTION_STRING": "{apsire-prototype-app-insights.connectionString}",
              "PORT": "{apsire-prototype-react.bindings.http.targetPort}",
              "BROWSER": "none",
            },
          "bindings":
            {
              "http":
                {
                  "scheme": "http",
                  "protocol": "tcp",
                  "transport": "http",
                  "targetPort": 8000,
                  "external": true,
                },
            },
        },
      "apsire-prototype-sql-server-password":
        {
          "type": "parameter.v0",
          "value": "{apsire-prototype-sql-server-password.inputs.value}",
          "inputs":
            {
              "value":
                {
                  "type": "string",
                  "secret": true,
                  "default":
                    {
                      "generate":
                        {
                          "minLength": 22,
                          "minLower": 1,
                          "minUpper": 1,
                          "minNumeric": 1,
                        },
                    },
                },
            },
        },
    },
}
